/* TypeFlow - Optimized Consolidated Styles */
/* Color System & Theming */
:root {
  --font-stack: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Fira Sans', 'Droid Sans', 'Helvetica Neue', Arial, sans-serif;
  --bg: #0a0f24;
  --bg-alt: #140c33;
  --bg-panel: #181b2b;
  --bg-panel-alt: #202436;
  --text: #e8ecf5;
  --text-dim: #778199;
  --accent: #7b4dff;
  --accent-glow: 263 100% 65%;
  --correct: #39ff88;
  --error: #ff2954;
  --warn: #ffb347;
  --border: rgba(255,255,255,0.08);
  --focus-ring: 180 100% 60%;
  --radius-xs: 3px;
  --radius-s: 6px;
  --radius-m: 12px;
  --radius-l: 20px;
  --shadow-base: 0 4px 14px -2px rgba(0,0,0,.55), 0 0 0 1px rgba(255,255,255,.04);
  --glow-accent: 0 0 0 1px hsla(var(--accent-glow)/.4), 0 0 14px -2px hsla(var(--accent-glow)/.9);
  --glow-error: 0 0 0 1px rgba(255,41,84,.5), 0 0 22px -4px rgba(255,41,84,.65);
  --glow-correct: 0 0 0 1px rgba(57,255,136,.5), 0 0 20px -4px rgba(57,255,136,.7);
  --transition: .18s cubic-bezier(.4,.2,.2,1);
  font-synthesis-weight: none;
  font-synthesis-style: none;
}

html[data-theme='light'] {
  --bg: #f3f6ff;
  --bg-alt: #e7ecff;
  --bg-panel: #ffffff;
  --bg-panel-alt: #f1f4fd;
  --text: #1d2233;
  --text-dim: #596175;
  --accent: #6a34ff;
  --correct: #0da95f;
  --error: #d3193f;
  --border: rgba(0,0,0,0.08);
  color-scheme: light;
}

/* Reset & Base */
* { box-sizing: border-box; }
html, body { height: 100%; margin: 0; }
body {
  font-family: var(--font-stack);
  background: radial-gradient(at 30% 18%, #1d1444, #0d0f1b 65%) fixed, linear-gradient(var(--bg), var(--bg-alt));
  background-blend-mode: overlay;
  color: var(--text);
  line-height: 1.5;
  -webkit-font-smoothing: antialiased;
  overflow-y: scroll;
}

body::before {
  content: '';
  position: fixed;
  inset: 0;
  pointer-events: none;
  background: repeating-linear-gradient(transparent 0 2px, rgba(255,255,255,0.007) 2px 4px);
  mix-blend-mode: overlay;
  opacity: .4;
  z-index: -1;
}

#particles { position: fixed; inset: 0; z-index: -2; }

/* Typography */
h1,h2,h3 { margin: 0 0 .6em; line-height: 1.1; font-weight: 600; }
p { margin: 0 0 1em; }

/* Layout */
.layout { 
  display: grid; 
  gap: 1.2rem; 
  padding: 1.1rem clamp(.8rem, 2.4vw, 2rem); 
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); 
}

.panel {
  background: linear-gradient(135deg, rgba(255,255,255,.04), rgba(255,255,255,.01));
  border: 1px solid var(--border);
  border-radius: var(--radius-m);
  padding: 1.05rem 1.1rem 1.3rem;
  position: relative;
  overflow: hidden;
  box-shadow: var(--shadow-base);
  backdrop-filter: blur(10px) saturate(1.05);
}

.panel::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at 14% 18%, rgba(123,77,255,.16), transparent 70%);
  opacity: .55;
  pointer-events: none;
  mix-blend-mode: screen;
}

.panel-title { 
  font-size: .9rem; 
  letter-spacing: 1px; 
  text-transform: uppercase; 
  opacity: .75; 
  margin: 0 0 .8rem; 
}

/* Header */
.app-header { 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  padding: .85rem 1.25rem; 
  backdrop-filter: blur(18px) saturate(1.4); 
  background: rgba(10,12,30,.55); 
  border-bottom: 1px solid var(--border); 
  position: sticky; 
  top: 0; 
  z-index: 20; 
}

.app-header h1 { 
  font-size: clamp(1.25rem,2.6vw,1.85rem); 
  letter-spacing: .5px; 
  display: flex; 
  gap: .5ch; 
  align-items: center; 
}

.brand-accent { 
  background: linear-gradient(95deg,#b487ff,#6f4bff 55%,#39ff88); 
  -webkit-background-clip: text; 
  background-clip: text; 
  color: transparent; 
  filter: drop-shadow(0 0 6px rgba(123,77,255,.6)); 
}

.user-status { font-size: .7rem; opacity: .65; }
.toolbar { display: flex; gap: .55rem; align-items: center; }

/* Buttons */
button { font-family: inherit; cursor: pointer; }

.btn, .btn-ghost, .btn-accent, .btn-danger, .primary-btn, .secondary-btn, .danger-btn { 
  --bg: var(--bg-panel); 
  --bg-hover: var(--bg-panel-alt); 
  --border: var(--border); 
  --color: var(--text); 
  display: inline-flex; 
  align-items: center; 
  gap: .45ch; 
  padding: .55rem .9rem; 
  font-size: .8rem; 
  border: 1px solid var(--border); 
  background: var(--bg); 
  color: var(--color); 
  border-radius: var(--radius-s); 
  position: relative; 
  transition: background var(--transition), color var(--transition), border-color var(--transition), transform var(--transition), box-shadow var(--transition); 
}

.btn-ghost { background: rgba(255,255,255,.02); }
.btn-accent, .primary-btn { 
  --bg: var(--accent); 
  --bg-hover: #8b6bff; 
  --border: var(--accent); 
  color: #fff; 
  font-weight: 600; 
  box-shadow: var(--glow-accent); 
}
.btn-accent:hover, .primary-btn:hover { filter: brightness(1.07); }
.btn-danger, .danger-btn { 
  --bg: var(--error); 
  --border: var(--error); 
  color: #fff; 
  box-shadow: var(--glow-error); 
}
.btn-small, .small { font-size: .7rem; padding: .45rem .65rem; }
.btn:active, button:active { transform: translateY(1px); }
.btn:focus-visible, button:focus-visible { 
  outline: 2px solid hsl(var(--focus-ring)); 
  outline-offset: 2px; 
}

/* Typing Interface */
.test-text { 
  font-family: 'JetBrains Mono','SF Mono', 'Fira Mono', 'Consolas', monospace; 
  font-size: 1.05rem; 
  line-height: 1.6; 
  min-height: 5.2rem; 
  white-space: pre-wrap; 
  word-break: break-word; 
  position: relative; 
}

.test-text span { 
  padding: 1px 2px; 
  border-radius: 4px; 
  transition: background .2s, color .2s, box-shadow .3s; 
}

.test-text span.current { 
  outline: 1px solid var(--accent); 
  background: rgba(123,77,255,.18); 
  box-shadow: 0 0 0 1px rgba(123,77,255,.4), 0 0 18px -4px rgba(123,77,255,.8); 
  animation: cursorPulse 1.8s ease-in-out infinite; 
}

.test-text span.correct { 
  color: var(--correct); 
  text-shadow: 0 0 6px rgba(57,255,136,.55); 
}

.test-text span.incorrect { 
  background: rgba(255,41,84,.18); 
  color: var(--error); 
  box-shadow: 0 0 0 1px rgba(255,41,84,.5); 
}

@keyframes cursorPulse { 
  0%,100% { box-shadow: 0 0 0 0 rgba(123,77,255,.55);} 
  50% { box-shadow: 0 0 0 10px rgba(123,77,255,0); } 
}

/* Key Stream */
.input-visualization { 
  display: flex; 
  gap: .4rem; 
  flex-wrap: wrap; 
  min-height: 2.4rem; 
  align-items: center; 
  margin-top: .7rem; 
}

.key-chip { 
  font-family: 'JetBrains Mono', monospace; 
  font-size: .8rem; 
  padding: .38rem .55rem; 
  border-radius: 7px; 
  background: var(--bg-panel-alt); 
  border: 1px solid rgba(255,255,255,.07); 
  position: relative; 
  min-width: 1.8rem; 
  text-align: center; 
  letter-spacing: .5px; 
}

.key-chip.good { 
  border-color: rgba(57,255,136,.7); 
  color: var(--correct); 
  box-shadow: var(--glow-correct); 
}

.key-chip.bad { 
  border-color: rgba(255,41,84,.7); 
  color: var(--error); 
  animation: shake .5s; 
  box-shadow: var(--glow-error); 
}

@keyframes shake { 
  0%,100% { transform: translateX(0);} 
  15% { transform: translateX(-4px);} 
  30% { transform: translateX(4px);} 
  45% { transform: translateX(-3px);} 
  60% { transform: translateX(3px);} 
  75% { transform: translateX(-1px);} 
}

.hint { font-size: .65rem; opacity: .6; margin-top: .45rem; letter-spacing: .5px; }

/* Suggestions */
.suggestion-list { 
  list-style: none; 
  margin: 0 0 1rem; 
  padding: 0; 
  display: flex; 
  flex-wrap: wrap; 
  gap: .55rem; 
}

.suggestion-list li { 
  background: var(--bg-panel-alt); 
  padding: .55rem .75rem; 
  border-radius: 8px; 
  font-family: 'JetBrains Mono', monospace; 
  font-size: .75rem; 
  letter-spacing: .6px; 
  border: 1px solid rgba(255,255,255,.08); 
  position: relative; 
  cursor: pointer; 
  transition: background var(--transition), transform var(--transition), box-shadow var(--transition); 
}

.suggestion-list li:hover { 
  background: rgba(123,77,255,.28); 
  box-shadow: 0 0 0 1px rgba(123,77,255,.5), 0 0 15px -4px rgba(123,77,255,.8); 
}

/* Stats */
.stats-grid { 
  display: grid; 
  grid-template-columns: repeat(auto-fill, minmax(90px,1fr)); 
  gap: .7rem .8rem; 
  margin-bottom: .9rem; 
}

.stat { display: flex; flex-direction: column; gap: .15rem; }
.stat .label { 
  font-size: .55rem; 
  text-transform: uppercase; 
  letter-spacing: 1px; 
  opacity: .55; 
}

.stat .value { 
  font-size: 1.1rem; 
  font-weight: 600; 
  letter-spacing: .5px; 
}

/* History */
.history-details { margin-top: .75rem; }
.history-list { 
  list-style: none; 
  margin: .5rem 0 0; 
  padding: 0; 
  max-height: 190px; 
  overflow: auto; 
  font-size: .65rem; 
  display: grid; 
  gap: .4rem; 
}

.history-list li { 
  padding: .4rem .55rem; 
  background: var(--bg-panel-alt); 
  border-radius: 6px; 
  display: flex; 
  justify-content: space-between; 
  gap: .6rem; 
  border: 1px solid rgba(255,255,255,.05); 
}

/* Keyboard Visualizer */
.keyboard { 
  display: grid; 
  gap: .25rem; 
  margin-top: 1rem; 
  user-select: none; 
  font-family: 'JetBrains Mono', monospace; 
}

.keyboard-row { display: flex; gap: .25rem; }
.k-key { 
  flex: 1; 
  background: var(--bg-panel-alt); 
  padding: .55rem .3rem; 
  text-align: center; 
  font-size: .65rem; 
  border-radius: 6px; 
  position: relative; 
  border: 1px solid rgba(255,255,255,.07); 
  transition: background .2s, box-shadow .25s, transform .2s, color .2s; 
}

.k-key[data-code='Space'] { flex: 4; }
.k-key.active { 
  background: rgba(123,77,255,.35); 
  box-shadow: var(--glow-accent); 
  color: #fff; 
}

.k-key.good { 
  background: rgba(57,255,136,.22); 
  box-shadow: var(--glow-correct); 
}

.k-key.bad { 
  background: rgba(255,41,84,.25); 
  box-shadow: var(--glow-error); 
}

/* Toast Notifications */
.toast-container { 
  position: fixed; 
  top: 1rem; 
  right: 1rem; 
  display: flex; 
  flex-direction: column; 
  gap: .7rem; 
  z-index: 999; 
  width: clamp(240px, 26vw, 340px); 
}

.toast { 
  background: linear-gradient(135deg, var(--bg-panel), var(--bg-panel-alt)); 
  border: 1px solid var(--border); 
  border-radius: var(--radius-m); 
  padding: .75rem .9rem .85rem; 
  font-size: .75rem; 
  display: flex; 
  align-items: flex-start; 
  gap: .65rem; 
  box-shadow: var(--shadow-base); 
  position: relative; 
  overflow: hidden; 
  animation: toastIn .5s ease; 
}

.toast::before { 
  content: ''; 
  position: absolute; 
  inset: 0; 
  background: radial-gradient(circle at 12% 16%, rgba(123,77,255,.4), transparent 70%); 
  opacity: .4; 
  pointer-events: none; 
}

.toast.success { 
  border-color: rgba(57,255,136,.7); 
  box-shadow: var(--glow-correct); 
}

.toast.error { 
  border-color: rgba(255,41,84,.7); 
  box-shadow: var(--glow-error); 
}

.toast .title { 
  font-weight: 600; 
  letter-spacing: .4px; 
  margin-bottom: 2px; 
}

.toast .close { 
  position: absolute; 
  top: 4px; 
  right: 6px; 
  background: none; 
  border: none; 
  color: inherit; 
  cursor: pointer; 
  font-size: .8rem; 
  opacity: .65; 
}

.toast .close:hover { opacity: 1; }

@keyframes toastIn { 
  from { transform: translateY(-10px); opacity: 0;} 
  to { transform: translateY(0); opacity: 1;} 
}

/* Dialog */
dialog { 
  border: 1px solid var(--border); 
  background: linear-gradient(135deg, var(--bg-panel), var(--bg-panel-alt)); 
  color: var(--text); 
  border-radius: var(--radius-l); 
  padding: 1.3rem 1.4rem 1.5rem; 
  box-shadow: var(--shadow-base), var(--glow-accent); 
  max-width: 520px; 
}

dialog::backdrop { 
  backdrop-filter: blur(9px) brightness(.6); 
  background: radial-gradient(circle at 30% 40%, rgba(123,77,255,.3), rgba(0,0,0,.55)); 
}

.auth-form { 
  display: flex; 
  flex-direction: column; 
  gap: .75rem; 
  margin-top: .5rem; 
}

.auth-form label { 
  font-size: .65rem; 
  letter-spacing: .8px; 
  text-transform: uppercase; 
  opacity: .7; 
}

.auth-form input { 
  background: var(--bg-panel-alt); 
  border: 1px solid rgba(255,255,255,.08); 
  padding: .6rem .65rem; 
  border-radius: var(--radius-s); 
  font: inherit; 
  color: var(--text); 
}

.auth-form input:focus { 
  outline: 2px solid var(--accent); 
  border-color: var(--accent); 
}

/* Accessibility */
.visually-hidden { 
  position: absolute !important; 
  height: 1px; 
  width: 1px; 
  padding: 0; 
  margin: -1px; 
  overflow: hidden; 
  clip: rect(0 0 0 0); 
  white-space: nowrap; 
  border: 0; 
}

/* Milestone Effects */
.milestone-glow { animation: msGlow 2.4s ease forwards; }

@keyframes msGlow { 
  0% { box-shadow: 0 0 0 0 rgba(57,255,136,.0);} 
  40% { box-shadow: 0 0 18px 2px rgba(57,255,136,.7);} 
  100% { box-shadow: 0 0 0 0 rgba(57,255,136,0);} 
}

/* Footer */
.app-footer { 
  text-align: center; 
  padding: 1rem; 
  font-size: .65rem; 
  opacity: .7; 
}

.app-footer a { color: var(--accent); }

/* Responsive */
@media (max-width: 680px) {
  .layout { grid-template-columns: 1fr; }
  .panel { padding: .95rem .9rem 1.1rem; }
  .test-text { font-size: .95rem; }
  .keyboard { font-size: .8rem; }
}